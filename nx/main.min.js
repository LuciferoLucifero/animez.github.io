function supports_html5_storage(){try{return"localStorage"in window&&null!==window.localStorage}catch(e){return!1}}function resizeWindow(){}function showAjaxError(e){globalMessage(e)}function numberEnd(e,t){return cases=[2,0,1,1,1,2],t[e%100>4&&20>e%100?2:cases[Math.min(e%10,5)]]}function numEpisodes(e){return-1==e?"?":e}function getInternetExplorerVersion(){var e=-1;if("Microsoft Internet Explorer"==navigator.appName){var t=navigator.userAgent,i=new RegExp("MSIE ([0-9]{1,}[.0-9]{0,})");null!=i.exec(t)&&(e=parseFloat(RegExp.$1))}else if("Netscape"==navigator.appName){var t=navigator.userAgent,i=new RegExp("Trident/.*rv:([0-9]{1,}[.0-9]{0,})");null!=i.exec(t)&&(e=parseFloat(RegExp.$1))}return e}function openVideoInFullscreen(){var e=$("#modal-fullscreen");$("body").css("overflow","hidden"),$("#fixed-nav").fadeOut(0),VideoInFullscreen=!0,resizeVideoInFullscreen(),e.find(".close").click(closeVideoInFullscreen),e.addClass("fullscreen"),"undefined"!=typeof yaCounter22758829&&yaCounter22758829.reachGoal("FULLSCREEN")}function closeVideoInFullscreen(){var e=$("#modal-fullscreen");return e.find(".modal-fullscreen-video").height("100%"),$("#fixed-nav").fadeIn(0),e.removeClass("fullscreen"),$("body").css("overflow","auto"),VideoInFullscreen=!1,!1}function resizeVideoInFullscreen(){if(0!=VideoInFullscreen){var e=parseInt($(window).height()),t=$("#modal-fullscreen"),i=parseInt(t.find(".modal-fullscreen-video-title").innerHeight());t.find(".modal-fullscreen-video").height(e-i+"px")}}function globalMessage(e,t,i){var s={message:"",type:"danger",nohide:!1,onClose:function(){}};if("object"!=typeof e){var a=e;e={message:a,type:t,nohide:i}}var o=$.extend({},s,e),n=6e3,r=100,l="globalMessage_"+gmc,d="danger";switch(o.type){case"success":d="success";break;case"info":d="info";break;default:d="danger"}$(".globalMessage").slideUp(r,function(){$(this).remove()}),setTimeout(function(){$('<div id="'+l+'" class="globalMessage '+d+'">'+o.message+'<a href="#" class="close"></a></div>').appendTo("body").slideDown(r).find(".close").click(function(e){e.preventDefault(),$("#"+l).slideUp(r,function(){$(this).remove(),o.onClose()})}),o.nohide||($("#"+l).on("mouseenter",function(){clearTimeout(gmint[l])}).on("mouseleave",function(){gmint[l]=setTimeout(function(){$("#"+l).slideUp(r,function(){$(this).remove()})},n)}),gmint[l]=setTimeout(function(){$("#"+l).slideUp(r,function(){$(this).remove()})},n)),gmc++},r)}function nextSeries(e,t){var i=$("#"+e).data("progress");return window.location.href="/series/"+t+"/"+(i+1),!1}function openEditSeries(e){$("#editSeriesContainer").fadeIn(150),$("#editSeriesContainer").data(e),$("#esc_title").text(e.title+(e.season>1?", "+e.season+" сезон":"")),$("#esc_progress").val(e.progress),$("#esc_episodes").text(numEpisodes(e.episodes)),$("#esc_status").val(e.status),$("#esc_status_select").customSelect("setValue",e.status),$("#editSeriesContainer").find('input[name="site_notifications"]').attr("checked",0!=e.siteNotifications),$("#editSeriesContainer").find('input[name="email_notifications"]').attr("checked",0!=e.emailNotifications).on("change",function(){$(this).is(":checked")?$("#esc_email_notifications_hint").show():$("#esc_email_notifications_hint").hide()}),1==e.emailNotifications?$("#esc_email_notifications_hint").show():$("#esc_email_notifications_hint").hide(),$("#esc_remove").off().on("click",function(){removeSeries(e.usId),$("#esc_remove").attr("disabled",!0).addClass("disabled")}).attr("disabled",!1).removeClass("disabled"),$("#esc_save").off().on("click",function(){saveSeries(),$("#esc_save").attr("disabled",!0).addClass("disabled")}).attr("disabled",!1).removeClass("disabled"),$("#esc_close").off().on("click",function(){$("#editSeriesContainer").fadeOut(150)}),e.published<e.episodes||-1==e.episodes?$("#esc_published_box").text(numberEnd(e.published,["Вышла","Вышло","Вышло"])+" "+e.published+" из "+numEpisodes(e.episodes)):$("#esc_published_box").text(""),e.published<e.episodes||-1==e.episodes?$("#esc_status_select").find('[data-value="1"]').parent().hide():$("#esc_status_select").find('[data-value="1"]').parent().show(),score.resetScore(e.score)}function removeSeries(e,t,i){e&&(i||(i=function(){}),$.ajax("/ajax/removeMySeries",{data:{id:e},dataType:"json",type:"POST",success:function(e){e.error?showAjaxError(e.error):(i(),t!==!0&&window.location.reload())}}))}function saveSeries(){var e=$("#editSeriesContainer"),t={id:e.data("usId"),progress:e.find('input[name="progress"]').val(),score:e.find('input[name="score"]').val(),status:e.find('input[name="status"]').val(),site_notifications:+e.find('input[name="site_notifications"]').is(":checked"),email_notifications:+e.find('input[name="email_notifications"]').is(":checked")};$.ajax("/ajax/saveMySeries",{data:t,dataType:"json",type:"POST",success:function(e){e.error?showAjaxError(e.error):window.location.reload()}})}function saveProgress(e,t,i){i||(i=function(){}),$.ajax("/ajax/saveProgress",{data:{id:e,episode_id:t},dataType:"json",type:"POST",success:function(e){e.error?showAjaxError(e.error):(i(),$("#set-episode-as-watched").removeClass("loading").addClass("active").text("Вы смотрели эту серию"))}})}function filter_init(e){if(0!=$("#filter").length){filter.tags=[],$("#filter li.selected").each(function(){var e=!1,t=$(this).data("tag_id");for(var i in filter.tags)filter.tags[i]==t&&(e=!0);e||filter.tags.push(t)});var t=filter.tags.length;t>0||filter_btn_clicked&&0==t?$("#btn-filter").removeClass("disabled").prop("disabled",!1).text(0==t?"Сбросить фильтр":"Фильтровать по "+t+" "+numberEnd(t,["тегу","тегам","тегам"])):$("#btn-filter").addClass("disabled").prop("disabled",!0).text("Отметьте желаемые теги")}}function filter_clear(){filter.page=0,getSeries(!0)}function shortDescription(){var e=$("#description");e.find(".text-break-link").click(function(t){t.preventDefault(),e.find(".text-break").hide(),e.find(".text-truncate").hide(0,function(){e.find(".text-rest").fadeIn()})})}function addToMySeries(e,t,i){$.ajax("/ajax/addInMySeries",{data:{id:e,status:t},dataType:"json",type:"POST",success:function(e){e.error?showAjaxError(e.error):i&&i(e.user_series_id)}})}function saveCollection(e){1!=$("#add-to-my-collections").data("loading")&&($("#add-to-my-series").data("loading",1),$("#add-to-my-collections div.control").addClass("loading"),$.ajax("/ajax/saveCollection",{data:{id:e},dataType:"json",type:"POST",success:function(e){$("#add-to-my-collections div.control").removeClass("loading"),e.error?showAjaxError(e.error):$("#add-to-my-collections div.control").toggleClass("active")}}))}function posUserMenu(){}function posSearchBox(){0!=$("#search-input").length&&$("#search-result").offset({top:$("#search-input").offset().top+$("#search-input").outerHeight(),left:$("#search-input").offset().left})}function hideSearch(){$("#search-input").val(""),$("#search-result").fadeOut(100),$(window).off("click",searchHideOnClicke)}function searchByName(){$.ajax("/ajax/searchByName",{data:{title:$("#search-input").val()},dataType:"json",type:"POST",success:function(e){var t="";if(e.series.length>0){for(var i in e.series){var s=e.series[i];t+='<li><a href="/'+(2==s.category?"dorama":"anime")+"/"+s.url+'">',t+='<div class="title">'+s.title+(s.season>1&&"TV"==s.type?", "+s.season+" сезон":"")+"</div>",t+='<div class="title-original">'+s.title_original+"</div>",t+='<div class="type">'+s.type+", "+s.year+"</div>",t+="</a></li>"}t="<ul>"+t+"</ul>",e.size>e.series.length&&(t+='<div class="results-count"><a href="/search?s='+encodeURIComponent($("#search-input").val())+'">Показать все <b>'+e.size+"</b> результатов</a></div>")}else t='<div class="no-results">Ничего не найдено ;(</div>';t+='<div class="results-count results-count-yandex"><a href="/search?searchid=2232328&text='+encodeURIComponent($("#search-input").val())+'">Показать результаты <span class="ya-first-letter">Я</span>ндекс.поиска</a></div>',$("#search-result").html(t).fadeIn(100),posSearchBox(),$(window).on("click",searchHideOnClicke)}})}function searchHideOnClicke(e){0==$(e.target).closest("#search-result").length&&0==$(e.target).closest("#search-input").length&&hideSearch()}function posAuthTips(){return}function showHiddenChronology(){$("#chronology").find("li:hidden").slideDown(100)}function editCategory(e){$("#modal_category").removeData(),e?($("#modal_category").data(e),$("#mc_title").text("Управление списком"),$("#mc_name").val(e.name),$("#mc_private").attr("checked",0!=e["private"]),$("#mc_remove").show(),$("#mc_save").text("Сохранить"),$("#mc_remove").off().on("click",function(){$.ajax("/ajax/removeCategory",{data:{id:$("#modal_category").data("id")},dataType:"json",type:"POST",success:function(e){e.error?showAjaxError(e.error):window.location.reload()}}),$("#mc_remove").attr("disabled",!0).addClass("disabled")}).attr("disabled",!1).removeClass("disabled")):($("#mc_name").val(""),$("#mc_title").text("Новый список"),$("#mc_remove").hide(),$("#mc_save").text("Добавить"),$("#mc_private").attr("checked",!1)),$("#mc_close").off().click(function(){$("#modal_category").fadeOut(150)}),$("#mc_save").off().click(function(){$("#mc_save").attr("disabled",!0).addClass("disabled");var e=$("#modal_category"),t={id:e.data("id")?e.data("id"):0,name:$("#mc_name").val(),"private":$("#mc_private").is(":checked")?1:0};$.ajax("/ajax/saveCategory",{data:t,dataType:"json",type:"POST",success:function(e){e.error?showAjaxError(e.error):window.location.reload(),$("#mc_save").attr("disabled",!1).removeClass("disabled")}})}),$("#modal_category").fadeIn(150,function(){$("#mc_name").focus()})}function fontLoader(){function e(e){var t=document.createElement("style");t.innerHTML=e,document.head.appendChild(t)}if(isModernBrowser){var t,i="font_css_cache";t=window.localStorage.getItem(i),t?e(t):window.addEventListener("load",function(){var e=new XMLHttpRequest;e.open("GET","/css/fonts/ptsans.css",!0),e.onload=function(){if(200==this.status)try{window.localStorage.setItem(i,this.response)}catch(e){}},e.send()})}}function loadScript(e,t){t="undefined"!=typeof t?t:{},$.ajax({type:"GET",url:e,success:t,dataType:"script",cache:!0})}function AuthForm(){this.$box=$("#auth-form-container"),this.$email=this.$box.find('[name="email"]'),this.$btn=this.$box.find("button:first"),this.storage=supports_html5_storage(),this.storageItemName="email",this.init()}function UserSettings(){this.$emailBox=$("#user-settings-email"),this.$email=this.$emailBox.find('[name="email"]'),this.$emailBtn=this.$emailBox.find("button:first"),this.$icons=$("#settings-icons-box"),this.init()}function getSeries(e){$(preload_tpl).appendTo("#catalog"),$("#catalog-load-more").hide(),series_loading=!0,$.ajax("/ajax/getSeries",{data:filter,dataType:"json",type:"POST",success:function(t){$("#catalog-preload-box").remove();var i="",s=t.series.length;if(s>0)for(var a in t.series){var o=t.series[a],n=o.score.split("."),r=o.poster.split("/"),l=o.votes>0?n[0]+(n[1]?'<span class="score_fract">.'+n[1]+"</span>":"")+'<div class="count">'+o.votes+" "+numberEnd(o.votes,["оценка","оценки","оценок"])+"</div>":'<div class="count no-votes">Еще никто<br> не голосовал</div>',d="series";1==o.category&&(d="anime"),2==o.category&&(d="dorama"),i+='<a href="/'+d+"/"+o.url+'" class="item" alt="'+o.title+(o.season>1&&"TV"==o.type?", "+o.season+" сезон":"")+'" title="'+o.title+(o.season>1&&"TV"==o.type?", "+o.season+" сезон":"")+'">',i+='<div class="image"><img src="http://i.wikianime.ru/'+r[3]+'" /></div>',i+='<div class="info-box">',i+='<div class="title"><span class="translate">'+o.title+(o.season>1&&"TV"==o.type?", "+o.season+"&nbsp;сезон":"")+'</span><span class="original">'+o.title_original+"</span></div>",i+='<div class="series-episodes">Серий: <span>'+(o.episodes_published==o.episodes?o.episodes_published:o.episodes_published+" из "+numEpisodes(o.episodes))+"</span></div>",i+='<div class="additional">',i+='<span class="rate">'+l+'</span><span class="year">'+o.type+", "+o.year+"</span>",i+="</div>",i+='</div><div class="progress-box">',i+='<div class="progress progress-sm">'+(o.episodes_published==o.episodes?o.episodes_published+" "+numberEnd(o.episodes_published,["серия","серии","серий"]):o.episodes_published+" из "+numEpisodes(o.episodes))+"</div>",i+="</div>",i+=1==o.soon?'<div class="soon">Анонс</div>':"",i+=1==o.ongoing&&0==o.soon?'<div class="ongoing">Ongoing</div>':"",i+="</a>"}1==t.next?(filter.page=filter.page+1,$("#catalog-load-more").show(),$("#catalog-no-more").hide()):($("#catalog-load-more").hide(),$("#catalog-no-more").show(),$(document).off("scroll",getSeriesOnScroll),isLoadBtnClicked=!1),e?$("#catalog").html(i):$("#catalog").append(i),series_loading=!1}})}function getSeriesOnScroll(){isLoadBtnClicked&&!series_loading&&$(window).scrollTop()>$(document).height()-$(window).height()-250&&getSeries()}var preload_tpl='<div id="catalog-preload-box"><div class="item"><div class="image"></div><div class="info-box"><div class="title"><span class="translate"></span><span class="original"></span></div></div><div class="progress-box"></div></div><div class="item"><div class="image"></div><div class="info-box"><div class="title"><span class="translate"></span><span class="original"></span></div></div><div class="progress-box"></div></div><div class="item"><div class="image"></div><div class="info-box"><div class="title"><span class="translate"></span><span class="original"></span></div></div><div class="progress-box"></div></div></div>',series_loading=!1,isLoadBtnClicked=!1,filter={},header_nav={offset:0,fixed:!1},isModernBrowser="querySelector"in document&&"localStorage"in window&&"addEventListener"in window,bookmarks={init:function(e,t){if(void 0==t)var t=!0;$("#user-bookmarks li").on("mouseover mouseout",function(e){if("mouseover"==e.type){if($(this).hasClass("active"))return;$(this).addClass("hover"),$(this).prev().addClass("hover_prev")}"mouseout"==e.type&&($(this).removeClass("hover"),$(this).prev().removeClass("hover_prev"))}),$("#user-bookmarks li").on("click",function(i){$("#user-bookmarks li").removeClass("active active_prev hover hover_prev"),$(this).addClass("active"),$(this).prev().addClass("active_prev");var s=$(this).data("target");$("#bookmarks-box").find(".bookmark").hide(),$("#bookmarks-box").find("#"+s).show(),t===!0&&window.history.replaceState&&window.history.replaceState(!1,document.title,e+"/"+s)})}},VideoInFullscreen=!1;$(document).keyup(function(e){27==e.keyCode&&1==VideoInFullscreen&&closeVideoInFullscreen()});var gmint={},gmc=0;!function(e){var t={customLabel:!1,onChange:function(){}},i={},s={init:function(a){return this.each(function(){i[e(this).attr("id")]=e.extend({},t,a);var o=i[e(this).attr("id")],n=e(this),r=n.find(".label"),l=!1;if(n.click(function(t){t.preventDefault(),e(this).addClass("active"),e(window).on("click",function(t){0==e(t.target).closest(n).length&&s.hide(n)})}),n.find(".dropdown a").each(function(){1==e(this).data("selected")&&(n.data("value",e(this).data("value")),r.text(e(this).text()),l=!0)}),!l&&!o.customLabel){var d=n.find(".dropdown a:first");n.data("value",d.data("value")),r.text(d.text())}n.find(".dropdown a").bind("click.customSelect",function(t){t.preventDefault(),s.onClick.apply(n,e(this))})})},setValue:function(t){return this.each(function(){var s=e(this),a=s.find(".label"),o=i[s.attr("id")];s.find(".dropdown a").each(function(){e(this).data("value")==t&&(s.data("value",e(this).data("value")),a.text(e(this).text()),o.onChange({value:t,label:a.text(),data:e(this).data()}))})})},onClick:function(t){var a=e(this),o=a.find(".label"),n=e(t),r=i[a.attr("id")];a.data("value")!=n.data("value")&&(o.text(n.data("label")?n.data("label"):n.text()),a.data("value",n.data("value")),r.onChange({value:n.data("value"),label:o.text(),data:n.data()}),console.log(n.data())),setTimeout(function(){s.hide(a)})},hide:function(e){e.removeClass("active")}};e.fn.customSelect=function(t,i){return s[t]?s[t].apply(this,Array.prototype.slice.call(arguments,1)):"object"!=typeof t&&t?void e.error("Метод с именем "+t+" не существует для jQuery.customSelect"):s.init.apply(this,arguments)}}(jQuery),$(function(){$("#translation_selector").customSelect({onChange:function(e){$("#main_iframe").attr("src",e.value),$("#report_player_id").val(e.data.id),"undefined"!=typeof yaCounter22758829&&yaCounter22758829.reachGoal("TRANSLATION_TYPE",{author:e.label})}}),$("#main-sort-by").find(".main-sort-link-box").click(function(e){e.preventDefault(),$(this).hasClass("active")||($("#main-sort-by").find(".main-sort-link-box").removeClass("active"),$(this).addClass("active"),filter.sort_by=$(this).data("value"),filter_clear())}),$("#esc_status_select").customSelect({onChange:function(e){1==e.value&&$("#esc_progress").val($("#editSeriesContainer").data("episodes")),$("#esc_status").val(e.value)}}),$(".js-series-edit").on("click",function(e){e.preventDefault();var t=$(this).data("target"),i=$("#"+t).data();openEditSeries(i)}),$(".progress-add").on("click",function(e){e.preventDefault()}),score.init()});var score={init:function(){$("#esc_scores").on("click","li",function(e){$("#esc_scores li").removeClass("active"),$(this).addClass("active"),$("#esc_scores").find('input[name="score"]').val($(this).text())})},resetScore:function(e){$("#esc_scores li").removeClass("active"),$("#esc_scores").find('input[name="score"]').val(e),e?$("#esc_scores li").each(function(){$(this).text()==e&&$(this).addClass("active")}):$("#esc_scores li:first").addClass("active")}},tagsFilter={init:function(){$("#season-filter, #tags-filter, #year-filter, #type-filter").find("a").click(function(e){e.preventDefault()}),$("#season-filter").find("li").on("click",function(e){if($(this).hasClass("selected"))$(this).removeClass("selected");else{var t=$(this).text();$("#season-filter").find("li").removeClass("selected"),$(this).toggleClass("selected"),"undefined"!=typeof yaCounter22758829&&yaCounter22758829.reachGoal("TAG",{season:t})}tagsFilter.search()}),$("#tags-filter").find("li").on("click",function(){if($(this).hasClass("selected"))$(this).removeClass("selected");else{var e=$(this).text();$(this).addClass("selected"),"undefined"!=typeof yaCounter22758829&&yaCounter22758829.reachGoal("TAG",{tag:e})}tagsFilter.search()}),$("#year-filter").find("li").on("click",function(){if($(this).hasClass("selected"))$("#year-filter").find("li").removeClass("selected");else{var e=$(this).text();$("#season-filter").find("li").removeClass("selected"),$("#year-filter").find("li").removeClass("selected"),$(this).toggleClass("selected"),"undefined"!=typeof yaCounter22758829&&yaCounter22758829.reachGoal("TAG",{year:e})}tagsFilter.search()}),$("#type-filter").find("li").on("click",function(){if($(this).hasClass("selected"))$("#type-filter").find("li").removeClass("selected");else{var e=$(this).text();$("#type-filter").find("li").removeClass("selected"),$(this).toggleClass("selected"),"undefined"!=typeof yaCounter22758829&&yaCounter22758829.reachGoal("TAG",{type:e})}tagsFilter.search()}),tagsFilter.filterInit()},filterInit:function(){filter.tags=[],filter.year="",filter.season="",filter.type="",$("#tags-filter .selected").each(function(){var e=!1,t=$(this).data("tag_id");for(var i in filter.tags)filter.tags[i]==t&&(e=!0);e||filter.tags.push(t)});var e=$("#season-filter .selected");1==e.length&&(filter.year=e.data("year"),filter.season=e.data("season"));var t=$("#type-filter .selected");1==t.length&&(filter.type=t.data("type"))},search:function(){tagsFilter.filterInit(),filter.page=0,getSeries(!0)}};$(function(){$("#filter").find(".tags li").on("click",function(){var e=$(this).data("tag_id");$("#filter").find('li[data-tag_id="'+e+'"]').toggleClass("selected"),filter_init()}),filter_init(!0),$("#catalog").on("mouseenter",".item",function(){$(this).find(".additional").slideDown(120),$(this).find(".edit").fadeIn(120)}),$("#catalog").on("mouseleave",".item",function(){$(this).find(".additional").slideUp(120),$(this).find(".edit").fadeOut(120)})});var searchKeyUpPause=500,searchID=0;$(function(){function e(t){$.ajax("/ajax/like",{data:{item_id:t.data("id"),type:t.data("type")},dataType:"json",type:"POST",statusCode:{500:function(){showAjaxError("Произошла ошибка. Попробуйте повторить запрос"),$(".js-like").click(function(i){i.preventDefault(),$(this).off(),t=$(this),e(t)})}},success:function(i){if(i.error)showAjaxError(i.error);else if(i.add&&t.addClass("active"),i.deleted&&t.removeClass("active"),"video"==t.data("type")){i.likes>0?$("#like-video-counter").text("Видео понравилось "+i.likes+" "+numberEnd(i.likes,["человеку","людям","людям"])):$("#like-video-counter").text("Понравилось видео?");var s="",a="";if(i.users_liked.length>0)for(var o=0;o<i.users_liked.length;o++)a=i.users_liked[o],s+='<a href="/user/'+a.id+'" class="item" title="'+a.name+'"><img src="'+a.photo_50+'" alt="'+a.name+'" /></a>';$("#like-video-users").html(s)}else t.find(".value").text(i.likes);$(".js-like").click(function(i){i.preventDefault(),$(this).off(),t=$(this),e(t)})}})}function t(e,t){$btn=e.parent(),$.ajax("/ajax/like",{data:{item_id:$btn.data("id"),type:$btn.data("type"),score:t},dataType:"json",type:"POST",statusCode:{500:function(){showAjaxError("Произошла ошибка. Попробуйте еще раз")}},success:function(e){e.liked=e.liked>0?"+"+e.liked:0,e.disliked=e.disliked>0?"-"+e.disliked:0,e.error?showAjaxError(e.error):1==e.deleted?($btn.data("liked",!1).find("button").removeClass("active disabled"),$btn.find(".rating-liked").text(e.liked),$btn.find(".rating-disliked").text(e.disliked)):($btn.data("liked",!0),$btn.find(".rating-liked").text(e.liked),$btn.find(".rating-disliked").text(e.disliked),"like"==t&&($btn.find(".rating-liked").addClass("active"),$btn.find(".rating-disliked").addClass("disabled")),"dislike"==t&&($btn.find(".rating-liked").addClass("disabled"),$btn.find(".rating-disliked").addClass("active")))}})}$(document).width()>1580&&$("body").addClass("bg-totoro"),$("#add-category").click(function(e){e.preventDefault(),editCategory(!1)}),$(".js-edit-category").click(function(e){e.preventDefault(),editCategory($(this).data())}),posUserMenu(),$(window).on("resize",posSearchBox),$(window).on("resize",posUserMenu);$(window).on("resize",resizeVideoInFullscreen),posAuthTips(),$("#user-photo").click(function(){$("#user-menu").show(),posSearchBox()}),$(window).on("click",function(e){0==$(e.target).closest("#user-menu").length&&0==$(e.target).closest("#user-photo").length&&$("#user-menu").hide()}),$("#search-input").on("keyup",function(){return 0==$(this).val().length?void hideSearch():void($(this).val().length<2||(clearTimeout(searchID),searchID=setTimeout(searchByName,searchKeyUpPause)))}),$("#show-search-box").click(function(){$(this).addClass("active"),$("#search-input").focus()}),$("#search-input").on("blur",function(){$("#show-search-box").removeClass("active")}),$("img.js-lazy").lazyload(),$("body").on("click",".js-vk_auth",function(e){getInternetExplorerVersion()>6&&(e.preventDefault(),globalMessage("Авторизация в Internet Explorer временно не работает. Воспользуйтесь любым другим браузером"))}),1==$("#fixed-nav").length&&(header_nav={offset:$("#fixed-nav").offset().top,fixed:!1}),$(".js-comment-dislike").click(function(e){e.preventDefault(),$btn=$(this),t($btn,"dislike")}),$(".js-comment-like").click(function(e){e.preventDefault(),$btn=$(this),t($btn,"like")}),$(".js-like").click(function(t){t.preventDefault(),$(this).off(),$btn=$(this),e($btn)}),$("#fullscreen").on("click",function(e){e.preventDefault(),openVideoInFullscreen()})}),$(function(){$(".js-link_open_comment").click(function(e){e.preventDefault();var t=$(this).data("id");$("#comment_text_"+t).show(),$(this).parent().hide()})}),AuthForm.prototype.init=function(){if(0!=this.$box.length&&(this.$email.keyup($.proxy(this.onEmailChange,this)),this.$email.change($.proxy(this.onEmailChange,this)),this.$btn.click($.proxy(this.onSubmit,this)),$("#auth-form-container .tab-link").click($.proxy(this.open,this)),$(document).click(function(e){0==$(e.target).closest("#auth-form-container").length&&0==$(e.target).closest(".open-auth-box").length&&$("#auth-form-container").removeClass("active")}),this.storage)){var e=window.localStorage.getItem(this.storageItemName)||"";this.$email.val(e),this.checkEmailByMask(e)}},AuthForm.prototype.open=function(e){e&&e.preventDefault(),$("#auth-form-container").addClass("active"),"undefined"!=typeof yaCounter22758829&&yaCounter22758829.reachGoal("open_auth_form")},AuthForm.prototype.onEmailChange=function(e){this.checkEmailByMask(e.currentTarget.value),this.storage&&window.localStorage.setItem(this.storageItemName,e.currentTarget.value)},AuthForm.prototype.checkEmailByMask=function(e){if(!e)var e=this.$email.val();var t=/^.+@.+\..+$/;e=e.trim(),t.test(e)?this.$btn.removeClass("disabled").attr("disabled",!1):this.$btn.addClass("disabled").attr("disabled",!0)},AuthForm.prototype.onSubmit=function(e){var t=this;this.$btn.addClass("processing").attr("disabled",!0),$.ajax("/auth/sendAuthLink",{data:{email:t.$email.val()},dataType:"json",type:"POST",success:function(e){t.$btn.removeClass("processing").attr("disabled",!1),e.error?showAjaxError(e.error):(globalMessage({type:"success",message:"Ссылка отправлена, проверьте вашу почту"}),$("#auth-form-container").removeClass("active"),t.$btn.removeClass("disabled processing").attr("disabled",!1))}})},UserSettings.prototype.init=function(){this.$email.keyup($.proxy(this.onEmailChange,this)),this.$email.change($.proxy(this.onEmailChange,this)),this.$emailBtn.click($.proxy(this.onSubmit,this)),this.bindIcons()},UserSettings.prototype.bindIcons=function(){var e=this;e.$icons.find(".icon-avatar-box").click(function(){$(this).hasClass("not-available")||$(this).hasClass("active")||(e.$icons.find(".icon-avatar-box").removeClass("active"),$(this).addClass("active"),e.$icons.find("#input-avatar-icon").val($(this).data("icon")))})},UserSettings.prototype.onEmailChange=function(e){this.checkEmailByMask(e.currentTarget.value)},UserSettings.prototype.checkEmailByMask=function(e){if(!e)var e=this.$email.val();var t=/^.+@.+\..+$/;e=e.trim(),t.test(e)?this.$emailBtn.removeClass("disabled").attr("disabled",!1):this.$emailBtn.addClass("disabled").attr("disabled",!0)},UserSettings.prototype.onSubmit=function(e){var t=this;this.$emailBtn.addClass("processing").attr("disabled",!0),$.ajax("/auth/sendBindLink",{data:{email:t.$email.val()},dataType:"json",type:"POST",success:function(e){t.$emailBtn.removeClass("processing").attr("disabled",!1),e.error?showAjaxError(e.error):(globalMessage({type:"success",message:"Мы отправили вам письмо с ссылкой для подтверждения адреса"}),t.$emailBtn.removeClass("disabled processing").attr("disabled",!1))}})},$(function(){new AuthForm}),$(function(){$("#catalog-load-more").click(function(){series_loading||getSeries(),isLoadBtnClicked||$(document).on("scroll",getSeriesOnScroll),isLoadBtnClicked=!0}),$("#link-all-tags").click(function(e){e.preventDefault(),$(this).hide(),$("#filter-all-tags").slideDown(150)}),tagsFilter.init()});var Comments=function(){this.$form_box=$("#commentForm"),this.$comments_box=$("#comments-box"),0!=this.$form_box.length&&(this.$form=this.$form_box.find("form"),this.$form_button=this.$form_box.find('button[type="submit"]'),this.$form_comment=this.$form_box.find("textarea"),this.init())};Comments.prototype.init=function(){this.$form.on("submit",$.proxy(this.onSubmitForm,this)),this.$comments_box.on("click",".reply",$.proxy(this.onReply,this)),$("#reply-cancel").on("click",$.proxy(this.cancelReply,this))},Comments.prototype.cancelReply=function(e){e.preventDefault(),$("#reply-for").css("display","none"),$("#reply-comment-id").val("")},Comments.prototype.onReply=function(e){var t=$(e.target).data();$("#reply-for span").text(t.userName),$("#reply-for").css("display","inline"),$("#reply-comment-id").val(t.commentId),this.$form_comment.focus()},Comments.prototype.onSubmitForm=function(e){return 0==this.$form_comment.val().trim().length?(this.$form_comment.focus(),void e.preventDefault()):(this.$form_button.addClass("ui-button-processing").attr("disabled",!0),!0)},Comments.prototype.clearForm=function(){this.$form_button.removeClass("ui-button-processing").attr("disabled",!1),this.$form_comment.removeClass("ui-input-disabled").attr("disabled",!1)},$(function(){new Comments,$("#open-sidebar").on("click",function(){$(this).hasClass("active")?($(this).removeClass("active"),$("#sidebar").removeClass("open")):($(this).addClass("active"),$("#sidebar").addClass("open"))}),$("#open-expanded-nav").on("click",function(){$(this).hasClass("active")?($(this).removeClass("active"),$("#expanded-nav").removeClass("open")):($(this).addClass("active"),$("#expanded-nav").addClass("open"))})});var VSeed=function(e){var t={limit:3,timer:30,preroll:!1,showOnMobile:!1,showInSafari:!1};this.params=$.extend({},t,e),this.clicked=!1,this.timer_started=null,this.init()};VSeed.prototype.init=function(){return 0==this.params.showOnMobile&&$(window).width()<=1024?!1:($(window).width()<=1024&&(this.params.preroll=!0),0==this.params.showInSafari&&/^((?!chrome|android).)*safari/i.test(navigator.userAgent)?!1:((navigator.userAgent.toLowerCase().indexOf("firefox")>-1||navigator.userAgent.toLowerCase().indexOf("edge")>-1)&&(this.params.preroll=!0),this.$box=$("#"+this.params.iframe_container),this.isVewsLimitReached()?!1:void this.showVS()))},VSeed.prototype.isVewsLimitReached=function(){if(!isModernBrowser)return!1;var e=new Date,t=e.getDate(),i=+localStorage.getItem("vs_views"),s=localStorage.getItem("vs_date");return s!=t&&(i=0,localStorage.setItem("vs_date",t),localStorage.setItem("vs_views",0)),i||(i=0,localStorage.setItem("vs_views",0)),i>=this.params.limit},VSeed.prototype.showCloseButton=function(){$('<span style="display:block;position:absolute;bottom:-12px;right:1px;background:#d9edf7;color:#31708f;border: 1px solid #bce8f1;padding:0 15px;z-index:1;height:40px;line-height:38px;" id="hideVSPlayer">Посмотрите рекламное видео, чтобы начать просмотр фильма</span>').appendTo(this.$box)},VSeed.prototype.startCloseCounter=function(){var e=this;this.timer_started=parseInt(Date.now()/1e3),this.interval_removeVS=setInterval(function(){var t=parseInt(Date.now()/1e3)-e.timer_started;return t>=e.params.timer?(clearInterval(e.interval_removeVS),void $("#hideVSPlayer").text("Пропустить рекламу").css({fontWeight:"bold",cursor:"pointer"}).on("click",function(){if(e.removeVS(),e.showOurPlayer(),$(this).remove(),isModernBrowser){var t=+localStorage.getItem("vs_views")+1;localStorage.setItem("vs_views",t)}})):void $("#hideVSPlayer").text("Пропустить рекламу через "+(e.params.timer-t)+" ")},1e3)},VSeed.prototype.showVS=function(){var e=this,t=document.getElementById(e.params.script_container);t.id=+new Date+Math.floor(1e3*Math.random())+"-vseed";var i=document.createElement("script");i.type="text/javascript",i.async=!0,0==e.params.preroll?i.src="https://videoseed.ru/oO/rotator?align=1&height="+e.params.height+"&width="+e.params.width+"&key="+e.params.key+"&pid="+e.params.pid+"&csid="+t.id:i.src="https://videoseed.ru/oO/rotator?align=1&height="+e.params.height+"&width="+e.params.width+"&key="+e.params.key+"&pid="+e.params.pid+"&tmpv="+e.params.tmpv+"&tmpt="+e.params.tmpt+"&csid="+t.id,i.charset="utf-8",t.parentNode.insertBefore(i,t),0==e.params.preroll&&e.isLoadedVS()},VSeed.prototype.isLoadedVS=function(){var e=this;this.interval_seekVS=setInterval(function(){e.$box.find("iframe").length>=2&&e.onLoadVS()},500)},VSeed.prototype.onLoadVS=function(){var e=this;clearInterval(e.interval_seekVS),this.showCloseButton(),this.hideOurPlayer(),blur(),e.$box.find("div").each(function(){$(this).attr("id")&&-1==$(this).attr("id").indexOf("subscribe")&&$(this).attr("style",function(e,t){return t+"width: 100% !important;"})});addEventListener("blur",function(){if(document.activeElement.id==e.$box.find("iframe:visible").attr("id")){if(e.clicked)return;e.clicked=!0,e.startCloseCounter()}})},VSeed.prototype.hideOurPlayer=function(){this.$box.find("img").hide(),this.$box.find(".iframe").hide()},VSeed.prototype.showOurPlayer=function(){this.$box.find("img").show(),this.$box.find(".iframe").show();
},VSeed.prototype.removeVS=function(){this.$box.find("div:first").remove()};